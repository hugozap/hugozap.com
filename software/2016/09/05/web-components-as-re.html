
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-517172-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-517172-9');
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <title>Web Components as React leaf nodes</title>
    
    <meta name="author" content="Hugo Zapata">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/css/tachyons.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

  </head>

  <body>

    <nav class="bt bb tc  center mt4 mb4">
      <a class="f6 f5-l link bg-animate black-80 hover-bg-lightest-blue dib pa3 ph4-l" href="/">Home</a>
      <a class="f6 f5-l link bg-animate black-80 hover-bg-light-green dib pa3 ph4-l" href="/archive.html">Blog</a>
      <a class="f6 f5-l link bg-animate black-80 hover-bg-light-pink dib pa3 ph4-l" href="/about">About</a>
    </nav>

    <article class="pa3 tc">

      

<style>
  h1,h2,h3{font-weight: 400;}  

.highlight {
  padding: 1rem;
  font-size: 0.8rem;
  overflow-x: auto;
}

  /* https://github.com/richleland/pygments-css/blob/master/monokai.css */
.highlight .hll { background-color: #49483e }
.highlight  { background: #272822; color: #f8f8f2 }
.highlight .c { color: #75715e } /* Comment */
.highlight .err { color: #960050; background-color: #1e0010 } /* Error */
.highlight .k { color: #66d9ef } /* Keyword */
.highlight .l { color: #ae81ff } /* Literal */
.highlight .n { color: #f8f8f2 } /* Name */
.highlight .o { color: #f92672 } /* Operator */
.highlight .p { color: #f8f8f2 } /* Punctuation */
.highlight .ch { color: #75715e } /* Comment.Hashbang */
.highlight .cm { color: #75715e } /* Comment.Multiline */
.highlight .cp { color: #75715e } /* Comment.Preproc */
.highlight .cpf { color: #75715e } /* Comment.PreprocFile */
.highlight .c1 { color: #75715e } /* Comment.Single */
.highlight .cs { color: #75715e } /* Comment.Special */
.highlight .gd { color: #f92672 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gi { color: #a6e22e } /* Generic.Inserted */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #75715e } /* Generic.Subheading */
.highlight .kc { color: #66d9ef } /* Keyword.Constant */
.highlight .kd { color: #66d9ef } /* Keyword.Declaration */
.highlight .kn { color: #f92672 } /* Keyword.Namespace */
.highlight .kp { color: #66d9ef } /* Keyword.Pseudo */
.highlight .kr { color: #66d9ef } /* Keyword.Reserved */
.highlight .kt { color: #66d9ef } /* Keyword.Type */
.highlight .ld { color: #e6db74 } /* Literal.Date */
.highlight .m { color: #ae81ff } /* Literal.Number */
.highlight .s { color: #e6db74 } /* Literal.String */
.highlight .na { color: #a6e22e } /* Name.Attribute */
.highlight .nb { color: #f8f8f2 } /* Name.Builtin */
.highlight .nc { color: #a6e22e } /* Name.Class */
.highlight .no { color: #66d9ef } /* Name.Constant */
.highlight .nd { color: #a6e22e } /* Name.Decorator */
.highlight .ni { color: #f8f8f2 } /* Name.Entity */
.highlight .ne { color: #a6e22e } /* Name.Exception */
.highlight .nf { color: #a6e22e } /* Name.Function */
.highlight .nl { color: #f8f8f2 } /* Name.Label */
.highlight .nn { color: #f8f8f2 } /* Name.Namespace */
.highlight .nx { color: #a6e22e } /* Name.Other */
.highlight .py { color: #f8f8f2 } /* Name.Property */
.highlight .nt { color: #f92672 } /* Name.Tag */
.highlight .nv { color: #f8f8f2 } /* Name.Variable */
.highlight .ow { color: #f92672 } /* Operator.Word */
.highlight .w { color: #f8f8f2 } /* Text.Whitespace */
.highlight .mb { color: #ae81ff } /* Literal.Number.Bin */
.highlight .mf { color: #ae81ff } /* Literal.Number.Float */
.highlight .mh { color: #ae81ff } /* Literal.Number.Hex */
.highlight .mi { color: #ae81ff } /* Literal.Number.Integer */
.highlight .mo { color: #ae81ff } /* Literal.Number.Oct */
.highlight .sa { color: #e6db74 } /* Literal.String.Affix */
.highlight .sb { color: #e6db74 } /* Literal.String.Backtick */
.highlight .sc { color: #e6db74 } /* Literal.String.Char */
.highlight .dl { color: #e6db74 } /* Literal.String.Delimiter */
.highlight .sd { color: #e6db74 } /* Literal.String.Doc */
.highlight .s2 { color: #e6db74 } /* Literal.String.Double */
.highlight .se { color: #ae81ff } /* Literal.String.Escape */
.highlight .sh { color: #e6db74 } /* Literal.String.Heredoc */
.highlight .si { color: #e6db74 } /* Literal.String.Interpol */
.highlight .sx { color: #e6db74 } /* Literal.String.Other */
.highlight .sr { color: #e6db74 } /* Literal.String.Regex */
.highlight .s1 { color: #e6db74 } /* Literal.String.Single */
.highlight .ss { color: #e6db74 } /* Literal.String.Symbol */
.highlight .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #a6e22e } /* Name.Function.Magic */
.highlight .vc { color: #f8f8f2 } /* Name.Variable.Class */
.highlight .vg { color: #f8f8f2 } /* Name.Variable.Global */
.highlight .vi { color: #f8f8f2 } /* Name.Variable.Instance */
.highlight .vm { color: #f8f8f2 } /* Name.Variable.Magic */
.highlight .il { color: #ae81ff } /* Literal.Number.Integer.Long */
</style>

<div class="w-80 mw7 dib">
 <section class="pagination tc">
      <ul class="list tl pa0 dib">
      
        <li class="prev dib br bw1 pr2 b--black"><a class="link dim black" href="/ui/2016/08/23/using-physics-for-wn" title="Using physics for natural web animations">&larr; Previous</a></li>
      
        <li class="dib br bw1 pr2"><a class="link dim green" href="/archive.html">Archive</a></li>
      
        <li class="next dib"><a class="link dim black" href="/software/2016/09/09/functional-css-in-re" title="Functional CSS for your next project">Next &rarr;</a></li>
      
      </ul>
    </section>



  <div class="post">
    <h1 class="f2 lh-title">Web Components as React leaf nodes</h1>
    <div class="content lh-copy f4 tl">
       
<p>There’s been a lot of discussion regarding the usage of Web Components and their relation with frameworks. As usual in the tech community, people (myself included) sometimes attach their identities to some particular technology and that prevents a healthy discussion.</p>

<p>After some thought I see the value in working with Web Components and using them with current tools/frameworks/libraries. The good thing about Web components is that they can be used in the same way other html elements are used. Common tasks like handling events work the same way as normal DOM elements(myCustomEl.addEventListener) and because WC is a platform feature (with increasing support in all modern browsers) everybody benefits.</p>

<p>Having used Polymer a lot in the past I had some confussion regarding compatibility with React components. My problem was that (like a lot of devs) all the exposure I’ve had to Web Components has been through Polymer and because Polymer uses additional abstractions and has it’s own established development workflow (somewhat separated from the current ecosystem) it was not easy to imagine how to use WC outside of the Polymer way of doing things.</p>

<p>Recently I found about the <a href="https://aframe.io/">a-frame</a> project. A really interesting VR library for the web that uses Web Components to create scenes in a declarative way. I wanted to try it with a simple react skeleton app ( created using create-react-app ).</p>

<p>I searched for a-frame react and found <a href="https://github.com/ngokevin/aframe-react">aframe-react</a> a project that converts some of the a-frame primitives to React elements. Curious about what’s required to do the conversion I checked <a href="https://github.com/ngokevin/aframe-react/blob/master/src/index.js">https://github.com/ngokevin/aframe-react/blob/master/src/index.js</a> and there’s nothing misterious about it. For example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Scene</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">propTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">onEnterVR</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="na">onExitVR</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span><span class="p">,</span>
    <span class="na">onLoaded</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PropTypes</span><span class="p">.</span><span class="nx">func</span>
  <span class="p">};</span>

  <span class="kr">static</span> <span class="nx">defaultProps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">onEnterVR</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
    <span class="na">onExitVR</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
    <span class="na">onLoaded</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{}</span>
  <span class="p">};</span>

  <span class="nx">attachEvents</span> <span class="o">=</span> <span class="nx">el</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'enter-vr'</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onEnterVR</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'exit-vr'</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onExitVR</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'loaded'</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onLoaded</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">a</span><span class="o">-</span><span class="nx">scene</span> <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">attachEvents</span><span class="p">}</span> <span class="p">{...</span><span class="nx">serializeComponents</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">)}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/a-scene</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The Custom Web Component element is a-scene and you can see it’s being used normally in the render method. The serializeComponents(this.props) call is just a utility method that stringifies components passed as an object, so: someAttr={primitive: box; width: 10} becomes someAttr=’primitive: box; width: 10’</p>

<p>For it to work, the a-scene element must be registered previously. That can be done by importing the ‘aframe’ module or including the script tag in the index.html</p>

<p>I did a quick example including <a href="https://github.com/chenglou/react-motion">react-motion</a> (physics based animation using springs) and it worked great.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">logo</span> <span class="k">from</span> <span class="s1">'./logo.svg'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'./App.css'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'aframe'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Scene</span><span class="p">,</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Sky</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'aframe-react'</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Motion</span><span class="p">,</span><span class="nx">spring</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'react-motion'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">spherePos</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="na">y</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="na">z</span><span class="p">:</span><span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span>
      <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span>
      <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">10</span><span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="na">spherePos</span><span class="p">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="mi">600</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">Scene</span><span class="o">&gt;</span> 
          <span class="o">&lt;</span><span class="nx">Motion</span> <span class="nx">defaultStyle</span><span class="o">=</span> <span class="nx">style</span><span class="o">=&gt;</span>
            <span class="p">{</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">Entity</span> <span class="nx">geometry</span><span class="o">=</span> <span class="nx">material</span><span class="o">=</span> <span class="nx">position</span><span class="o">=</span><span class="p">{[</span><span class="nx">value</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">value</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="o">-</span><span class="nx">value</span><span class="p">.</span><span class="nx">z</span><span class="p">]}</span><span class="sr">/&gt;</span><span class="err">}
</span>          <span class="o">&lt;</span><span class="sr">/Motion</span><span class="err">&gt;
</span>          
          <span class="p">....</span> <span class="nx">Duplicated</span> <span class="nx">non</span> <span class="nx">interesting</span> <span class="nx">code</span> <span class="nx">cut</span> <span class="p">...</span>

          <span class="o">&lt;</span><span class="nx">Entity</span> <span class="nx">camera</span><span class="o">=</span><span class="s2">"userHeight: 1.8"</span> <span class="nx">look</span><span class="o">-</span><span class="nx">controls</span> <span class="nx">position</span><span class="o">=</span><span class="p">{[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]}</span><span class="o">&gt;&lt;</span><span class="sr">/Entity</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">Entity</span> <span class="nx">geometry</span><span class="o">=</span>
          <span class="nx">material</span><span class="o">=</span><span class="s2">"color: cyan; metalness: 0.7"</span><span class="o">&gt;&lt;</span><span class="sr">/Entity</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">Entity</span> <span class="nx">sky</span><span class="o">=</span><span class="s2">" "</span> <span class="o">/&gt;</span>
       <span class="o">&lt;</span><span class="sr">/Scene</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div></div>
<p><a href="https://gist.github.com/hugozap/da13f467352fe127c6c47e9ad754ebcb">source here</a>
This is the result</p>

<blockquote class="twitter-video" data-lang="es"><p lang="en" dir="ltr">React Motion can be used to add physics based animation (spring) to a-frame apps for cool VR or 3D experiences. <a href="https://t.co/KxTh3JbbvM">pic.twitter.com/KxTh3JbbvM</a></p>&mdash; Hugo Zapata (@hugozap) <a href="https://twitter.com/hugozap/status/772298823582437376">4 de septiembre de 2016</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>One of the misconceptions I had with WC is thinking HTML Imports are required (because that’s what Polymer components use). That’s not true from what I’ve seen. Just make sure at some point registerElement is called for the custom web component (Usually that’s done by the WC npm module)</p>

<p>I hope to keep learning about new usage patters and how to integrate WC in my workflow. Fortunately from what I’ve seen in recent twitter threads, the Chrome developer relations team is commited to keep promoting WC and their integration with the current ecosystem.</p>


    </div>
  </div> 


  <section class="published tr">
    
    <h4 class="dib">Published</h4>
    <div class="date dib"><span>05 September 2016</span>
    </div>

  </section>

  <hr/>
    <section class="pagination tc">
      <ul class="list tl pa0 dib">
      
        <li class="prev dib br bw1 pr2 b--black"><a class="link dim black" href="/ui/2016/08/23/using-physics-for-wn" title="Using physics for natural web animations">&larr; Previous</a></li>
      
        <li class="dib br bw1 pr2"><a class="link dim black" href="/archive.html">Archive</a></li>
      
        <li class="next dib"><a class="link dim black" href="/software/2016/09/09/functional-css-in-re" title="Functional CSS for your next project">Next &rarr;</a></li>
      
      </ul>
    </section>

  
   

  <hr/>
  

    <section class="tags flex mt2 pv2 pr2">
      <h4 class="black-80 ma0 pv2">Tags</h4>
      <ul class="list ma0 w-100 tl">
      
      


  
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#react-ref">react <span>7</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#ui-ref">ui <span>3</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#web-ref">web <span>8</span></a></li>
    
  



      </ul>
    </section>

    
</div>



    </article>
    <hr/>
  </body>
</html>

