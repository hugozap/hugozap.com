
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-517172-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-517172-9');
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <title>Sending and receiving dates from android/java/dotnet the easy way</title>
    
    <meta name="author" content="Hugo Zapata">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/css/tachyons.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

  </head>

  <body>

    <nav class="bt bb tc  center mt4 mb4">
      <a class="f6 f5-l link bg-animate black-80 hover-bg-lightest-blue dib pa3 ph4-l" href="/">Home</a>
      <a class="f6 f5-l link bg-animate black-80 hover-bg-light-green dib pa3 ph4-l" href="/archive.html">Blog</a>
      <a class="f6 f5-l link bg-animate black-80 hover-bg-light-pink dib pa3 ph4-l" href="/about">About</a>
    </nav>

    <article class="pa3 tc">

      

<style>
  h1,h2,h3{font-weight: 400;}  

.highlight {
  padding: 1rem;
  font-size: 0.8rem;
  overflow-x: auto;
}

  /* https://github.com/richleland/pygments-css/blob/master/monokai.css */
.highlight .hll { background-color: #49483e }
.highlight  { background: #272822; color: #f8f8f2 }
.highlight .c { color: #75715e } /* Comment */
.highlight .err { color: #960050; background-color: #1e0010 } /* Error */
.highlight .k { color: #66d9ef } /* Keyword */
.highlight .l { color: #ae81ff } /* Literal */
.highlight .n { color: #f8f8f2 } /* Name */
.highlight .o { color: #f92672 } /* Operator */
.highlight .p { color: #f8f8f2 } /* Punctuation */
.highlight .ch { color: #75715e } /* Comment.Hashbang */
.highlight .cm { color: #75715e } /* Comment.Multiline */
.highlight .cp { color: #75715e } /* Comment.Preproc */
.highlight .cpf { color: #75715e } /* Comment.PreprocFile */
.highlight .c1 { color: #75715e } /* Comment.Single */
.highlight .cs { color: #75715e } /* Comment.Special */
.highlight .gd { color: #f92672 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gi { color: #a6e22e } /* Generic.Inserted */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #75715e } /* Generic.Subheading */
.highlight .kc { color: #66d9ef } /* Keyword.Constant */
.highlight .kd { color: #66d9ef } /* Keyword.Declaration */
.highlight .kn { color: #f92672 } /* Keyword.Namespace */
.highlight .kp { color: #66d9ef } /* Keyword.Pseudo */
.highlight .kr { color: #66d9ef } /* Keyword.Reserved */
.highlight .kt { color: #66d9ef } /* Keyword.Type */
.highlight .ld { color: #e6db74 } /* Literal.Date */
.highlight .m { color: #ae81ff } /* Literal.Number */
.highlight .s { color: #e6db74 } /* Literal.String */
.highlight .na { color: #a6e22e } /* Name.Attribute */
.highlight .nb { color: #f8f8f2 } /* Name.Builtin */
.highlight .nc { color: #a6e22e } /* Name.Class */
.highlight .no { color: #66d9ef } /* Name.Constant */
.highlight .nd { color: #a6e22e } /* Name.Decorator */
.highlight .ni { color: #f8f8f2 } /* Name.Entity */
.highlight .ne { color: #a6e22e } /* Name.Exception */
.highlight .nf { color: #a6e22e } /* Name.Function */
.highlight .nl { color: #f8f8f2 } /* Name.Label */
.highlight .nn { color: #f8f8f2 } /* Name.Namespace */
.highlight .nx { color: #a6e22e } /* Name.Other */
.highlight .py { color: #f8f8f2 } /* Name.Property */
.highlight .nt { color: #f92672 } /* Name.Tag */
.highlight .nv { color: #f8f8f2 } /* Name.Variable */
.highlight .ow { color: #f92672 } /* Operator.Word */
.highlight .w { color: #f8f8f2 } /* Text.Whitespace */
.highlight .mb { color: #ae81ff } /* Literal.Number.Bin */
.highlight .mf { color: #ae81ff } /* Literal.Number.Float */
.highlight .mh { color: #ae81ff } /* Literal.Number.Hex */
.highlight .mi { color: #ae81ff } /* Literal.Number.Integer */
.highlight .mo { color: #ae81ff } /* Literal.Number.Oct */
.highlight .sa { color: #e6db74 } /* Literal.String.Affix */
.highlight .sb { color: #e6db74 } /* Literal.String.Backtick */
.highlight .sc { color: #e6db74 } /* Literal.String.Char */
.highlight .dl { color: #e6db74 } /* Literal.String.Delimiter */
.highlight .sd { color: #e6db74 } /* Literal.String.Doc */
.highlight .s2 { color: #e6db74 } /* Literal.String.Double */
.highlight .se { color: #ae81ff } /* Literal.String.Escape */
.highlight .sh { color: #e6db74 } /* Literal.String.Heredoc */
.highlight .si { color: #e6db74 } /* Literal.String.Interpol */
.highlight .sx { color: #e6db74 } /* Literal.String.Other */
.highlight .sr { color: #e6db74 } /* Literal.String.Regex */
.highlight .s1 { color: #e6db74 } /* Literal.String.Single */
.highlight .ss { color: #e6db74 } /* Literal.String.Symbol */
.highlight .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #a6e22e } /* Name.Function.Magic */
.highlight .vc { color: #f8f8f2 } /* Name.Variable.Class */
.highlight .vg { color: #f8f8f2 } /* Name.Variable.Global */
.highlight .vi { color: #f8f8f2 } /* Name.Variable.Instance */
.highlight .vm { color: #f8f8f2 } /* Name.Variable.Magic */
.highlight .il { color: #ae81ff } /* Literal.Number.Integer.Long */
</style>

<div class="w-80 mw7 dib">
 <section class="pagination tc">
      <ul class="list tl pa0 dib">
      
        <li class="prev dib br bw1 pr2 b--black"><a class="link dim black" href="/software/2012/03/21/KnockoutJs-rocks" title="KnockoutJS rocks for web development">&larr; Previous</a></li>
      
        <li class="dib br bw1 pr2"><a class="link dim green" href="/archive.html">Archive</a></li>
      
        <li class="next dib"><a class="link dim black" href="/software/2012/05/14/cloud9-start-script" title="Shell script to prompt for parameters and start Cloud9 IDE in a different directory and port">Next &rarr;</a></li>
      
      </ul>
    </section>



  <div class="post">
    <h1 class="f2 lh-title">Sending and receiving dates from android/java/dotnet the easy way</h1>
    <div class="content lh-copy f4 tl">
       
<h2 id="the-problem">The problem</h2>

<p>Date serializing is not as easy as it sounds. If you are using JSON is possible that you will encounter problems with formats, time zone representation, etc.</p>

<p>If you need to send and receive dates from the server to android you have to take this issues into account</p>

<p>Besides that, there is the timezone architecture decision. How will you store your dates?. Will you store everything in UTC? (I prefer this) or will you store the date and have separate columns to store timezone information ( works too but makes date handling more difficult ).</p>

<h2 id="differences-in-parsers-and-formatters">Differences in parsers and formatters</h2>

<p>I’m working on  a mobile application (Android) that sends and receives data from a .NET Backend.
At first i chose ISO Format to send and receive dates. Everything is stored as UTC and only converted to local time to display information to the user.</p>

<p>One problem i faced was that one part was sending the Z character and the other part didn’t understand it. I checked the format strings and everything appeared ok.
After a little googling, i noticed that some APIs used unixtime format and i realized that this is the simplest way to handle it. And i like simplicity.</p>

<h3 id="working-with-unix-time-stamps-in-android-java">Working with unix time stamps in android (java)</h3>
<p>I decided to store the dates as unix time stamps and forget about date handling in sqlite, java, json, .net ( a lot of potential errors ). 
Dates will be sent and received as long values (no json hacks) and i had to have a way to convert those values to the native Date type in the server and client</p>

<p>(note: I use Gson as the Json serializar)</p>

<p>In java i have the following method utilities</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">toUnixTime</span><span class="o">(</span><span class="n">Date</span> <span class="n">d</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="na">getTime</span><span class="o">()/</span><span class="mi">1000L</span><span class="o">;</span>
	<span class="o">}</span>
	
		<span class="kd">public</span> <span class="kd">static</span> <span class="n">Date</span> <span class="nf">FromUnixTime</span><span class="o">(</span><span class="kt">long</span> <span class="n">unix_time</span><span class="o">)</span>
	<span class="o">{</span>	
		<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span> <span class="o">();</span>
		<span class="n">date</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="n">unix_time</span><span class="o">*</span><span class="mi">1000</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">date</span><span class="o">;</span>
	<span class="o">}</span></code></pre></figure>

<p>With Gson one can create custom serializers/deserializers, that’s what we want to send and receive the date as a number:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnixTimeSerializer</span> <span class="kd">implements</span> <span class="n">JsonSerializer</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	  <span class="kd">public</span> <span class="n">JsonElement</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">Date</span> <span class="n">src</span><span class="o">,</span> <span class="n">Type</span> <span class="n">typeOfSrc</span><span class="o">,</span> <span class="n">JsonSerializationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

		<span class="n">JsonNull</span> <span class="n">jnull</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonNull</span><span class="o">();</span>
		<span class="k">if</span><span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
			<span class="k">return</span> <span class="n">jnull</span><span class="o">;</span>
		
	    <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonPrimitive</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">toUnixTime</span><span class="o">(</span><span class="n">src</span><span class="o">));</span>
	  <span class="o">}</span>
	<span class="o">}</span>
	
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnixTimeDeserializer</span> <span class="kd">implements</span> <span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">deserialize</span><span class="o">(</span><span class="n">JsonElement</span> <span class="n">json</span><span class="o">,</span> <span class="n">Type</span> <span class="n">typeOfT</span><span class="o">,</span> <span class="n">JsonDeserializationContext</span> <span class="n">context</span><span class="o">)</span>
	      <span class="kd">throws</span> <span class="n">JsonParseException</span> <span class="o">{</span>

		<span class="k">if</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">isJsonNull</span><span class="o">())</span>
			  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		  <span class="kt">long</span> <span class="n">unixstamp</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsLong</span><span class="o">();</span>		  
		  <span class="k">return</span> <span class="n">ObassiDateUtils</span><span class="o">.</span><span class="na">FromUnixTime</span><span class="o">(</span><span class="n">unixstamp</span><span class="o">);</span>
	  <span class="o">}</span>
	<span class="o">}</span>

	</code></pre></figure>

<p>And to setup the serializers i use the following code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">().</span><span class="na">setDateFormat</span><span class="o">(</span><span class="n">ObassiDateUtils</span><span class="o">.</span><span class="na">isoFormat</span><span class="o">)</span>
				<span class="o">.</span><span class="na">registerTypeAdapter</span><span class="o">(</span><span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">UnixTimeSerializer</span><span class="o">())</span>
				<span class="o">.</span><span class="na">registerTypeAdapter</span><span class="o">(</span><span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">UnixTimeDeserializer</span><span class="o">())</span>
				<span class="o">.</span><span class="na">create</span><span class="o">();</span>
				</code></pre></figure>

<p>The json received from server contains the unix timestamp, however gson deserializes it into the class i select and populates the corresponding date fields.</p>

    </div>
  </div> 


  <section class="published tr">
    
    <h4 class="dib">Published</h4>
    <div class="date dib"><span>09 April 2012</span>
    </div>

  </section>

  <hr/>
    <section class="pagination tc">
      <ul class="list tl pa0 dib">
      
        <li class="prev dib br bw1 pr2 b--black"><a class="link dim black" href="/software/2012/03/21/KnockoutJs-rocks" title="KnockoutJS rocks for web development">&larr; Previous</a></li>
      
        <li class="dib br bw1 pr2"><a class="link dim black" href="/archive.html">Archive</a></li>
      
        <li class="next dib"><a class="link dim black" href="/software/2012/05/14/cloud9-start-script" title="Shell script to prompt for parameters and start Cloud9 IDE in a different directory and port">Next &rarr;</a></li>
      
      </ul>
    </section>

  
   

  <hr/>
  

    <section class="tags flex mt2 pv2 pr2">
      <h4 class="black-80 ma0 pv2">Tags</h4>
      <ul class="list ma0 w-100 tl">
      
      


  
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#dotnet-ref">dotnet <span>2</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#java-ref">java <span>2</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#android-ref">android <span>4</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#mobile-ref">mobile <span>2</span></a></li>
     
    	<li class="dib mh2 white bg-white ba bw2 b--black br2 pa2"><a class="link black-80 dim" href="/tags.html#date serialization-ref">date serialization <span>2</span></a></li>
    
  



      </ul>
    </section>

    
</div>



    </article>
    <hr/>
  </body>
</html>

