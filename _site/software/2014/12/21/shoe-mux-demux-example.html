
<p>In a realtime app it&#8217;s common to have multiple data streams coming from the server. The mechanism to handle the different connections could include among others:</p>

<ul>
  <li>frequent pooling to the server (possible perf issues if multiple requests are made at the same time)</li>
  <li>one socket per data stream ( possible perf issues in server and client)</li>
</ul>

<p>A better alternative</p>

<p>Multiple data streams but just one channel (1 web socket).</p>

<p>This is what mux-demux refers to (multiplex-demultiplex), and can be very useful
for situations when having multiple transport channels (in this case sockets) is not practical.</p>

<p><img src="https://github.com/hugozap/shoe-reconnect-muxdemux-example/raw/master/muxdemux.png" alt="Mux-demux" /></p>

<h3 id="how-to-use-mux-demux">How to use mux-demux?</h3>

<p>To have a reference for future projects i created a minimal sample that demostrates how to send multiple data streams over one connection. The following modules are used:</p>

<p><a href="http://github.com/substack/shoe">shoe</a>: Creates a stream over a websocket so we can use the same streams Api we love.</p>

<p><a href="https://github.com/juliangruber/reconnect-core">reconnect-core</a> : Gives us the ability to execute a method everytime we need to reconnect to the server in case connection is lost.</p>

<p><a href="https://github.com/dominictarr/mux-demux">mux-demux</a> : Inject multiple streams into another stream and extract them from the other side.</p>

<p><a href="http://github.com/substack/browserify">browserify</a> : Use npm modules in the browser.</p>

<p>The example consist of 9 streams that emit random numbers. We want to send those streams to the browser and display them in realtime.</p>

<p>Animated gif:</p>

<p><img src="https://github.com/hugozap/shoe-reconnect-muxdemux-example/raw/master/sample.gif" alt="example" /></p>

<h3 id="the-code">The code</h3>

<p><a href="https://github.com/hugozap/shoe-reconnect-muxdemux-example">Example repository</a></p>

<p>The important part is here (index.js)</p>

<script src="https://gist.github.com/hugozap/66576498c3af911fcc61.js"></script>

<h3 id="reconnection">Reconnection.</h3>

<p>If the server goes down, we need to reconnect. For this there is a module callled reconnect-core that we can use.</p>

<p>Check <a href="https://github.com/hugozap/shoe-reconnect-muxdemux-example/blob/master/browser.js">browser.js</a> to see how to implement it.</p>

