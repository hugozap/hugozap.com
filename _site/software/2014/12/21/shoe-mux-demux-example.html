<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Multiple data streams over just one socket with mux-demux and shoe (node) | hugozap Hugo Zapata</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Multiple data streams over just one socket with mux-demux and shoe (node)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In a realtime app it’s common to have multiple data streams coming from the server. The mechanism to handle the different connections could include among others:" />
<meta property="og:description" content="In a realtime app it’s common to have multiple data streams coming from the server. The mechanism to handle the different connections could include among others:" />
<link rel="canonical" href="https://hugozap.com/software/2014/12/21/shoe-mux-demux-example.html" />
<meta property="og:url" content="https://hugozap.com/software/2014/12/21/shoe-mux-demux-example.html" />
<meta property="og:site_name" content="hugozap Hugo Zapata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-12-21T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"In a realtime app it’s common to have multiple data streams coming from the server. The mechanism to handle the different connections could include among others:","@type":"BlogPosting","url":"https://hugozap.com/software/2014/12/21/shoe-mux-demux-example.html","headline":"Multiple data streams over just one socket with mux-demux and shoe (node)","dateModified":"2014-12-21T00:00:00-05:00","datePublished":"2014-12-21T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hugozap.com/software/2014/12/21/shoe-mux-demux-example.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://hugozap.com/feed.xml" title="hugozap | Hugo Zapata" /></head>
<body class="w-100 sans-serif bg-white"><header class="bg-black-90  fixed top-0 w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-2"><nav class="f6 fw6 ttu tracked tl tr-ns relative tc">
    <a class="relative block absolute-ns dib-ns left-0 link dim white " href="/">hugozap | Hugo Zapata</a><a class="link dim white dib mr3" href="/about/" title="About">About</a></nav></header>

<main class="ph3 pv5 pa5-ns mt3 mt5-ns" aria-label="Content">
        <article class="measure-wide lh-copy" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 class="f3 f2-m f1-l" itemprop="name headline">Multiple data streams over just one socket with mux-demux and shoe (node)</h1>
    <p class="">
      <time class="" datetime="2014-12-21T00:00:00-05:00" itemprop="datePublished">Dec 21, 2014
      </time></p>
  </header>
  <p class="lh-copy">
    <p>In a realtime app it’s common to have multiple data streams coming from the server. The mechanism to handle the different connections could include among others:</p>

<ul>
  <li>frequent pooling to the server (possible perf issues if multiple requests are made at the same time)</li>
  <li>one socket per data stream ( possible perf issues in server and client)</li>
</ul>

<p>A better alternative</p>

<p>Multiple data streams but just one channel (1 web socket).</p>

<p>This is what mux-demux refers to (multiplex-demultiplex), and can be very useful
for situations when having multiple transport channels (in this case sockets) is not practical.</p>

<p><img src="https://github.com/hugozap/shoe-reconnect-muxdemux-example/raw/master/muxdemux.png" alt="Mux-demux" /></p>

<h3 id="how-to-use-mux-demux">How to use mux-demux?</h3>

<p>To have a reference for future projects i created a minimal sample that demostrates how to send multiple data streams over one connection. The following modules are used:</p>

<p><a href="http://github.com/substack/shoe">shoe</a>: Creates a stream over a websocket so we can use the same streams Api we love.</p>

<p><a href="https://github.com/juliangruber/reconnect-core">reconnect-core</a> : Gives us the ability to execute a method everytime we need to reconnect to the server in case connection is lost.</p>

<p><a href="https://github.com/dominictarr/mux-demux">mux-demux</a> : Inject multiple streams into another stream and extract them from the other side.</p>

<p><a href="http://github.com/substack/browserify">browserify</a> : Use npm modules in the browser.</p>

<p>The example consist of 9 streams that emit random numbers. We want to send those streams to the browser and display them in realtime.</p>

<p>Animated gif:</p>

<p><img src="https://github.com/hugozap/shoe-reconnect-muxdemux-example/raw/master/sample.gif" alt="example" /></p>

<h3 id="the-code">The code</h3>

<p><a href="https://github.com/hugozap/shoe-reconnect-muxdemux-example">Example repository</a></p>

<p>The important part is here (index.js)</p>

<script src="https://gist.github.com/hugozap/66576498c3af911fcc61.js"></script>

<h3 id="reconnection">Reconnection.</h3>

<p>If the server goes down, we need to reconnect. For this there is a module callled reconnect-core that we can use.</p>

<p>Check <a href="https://github.com/hugozap/shoe-reconnect-muxdemux-example/blob/master/browser.js">browser.js</a> to see how to implement it.</p>


  </p>
  <a class="" href="/software/2014/12/21/shoe-mux-demux-example.html" hidden></a>

</article>


    </main></body>

</html>
