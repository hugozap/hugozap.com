<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Sending and receiving dates from android/java/dotnet the easy way | hugozap Hugo Zapata</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Sending and receiving dates from android/java/dotnet the easy way" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The problem" />
<meta property="og:description" content="The problem" />
<link rel="canonical" href="https://hugozap.com/software/2012/04/09/unixtimestamps1.html" />
<meta property="og:url" content="https://hugozap.com/software/2012/04/09/unixtimestamps1.html" />
<meta property="og:site_name" content="hugozap Hugo Zapata" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-04-09T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"The problem","@type":"BlogPosting","url":"https://hugozap.com/software/2012/04/09/unixtimestamps1.html","headline":"Sending and receiving dates from android/java/dotnet the easy way","dateModified":"2012-04-09T00:00:00-05:00","datePublished":"2012-04-09T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hugozap.com/software/2012/04/09/unixtimestamps1.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://hugozap.com/feed.xml" title="hugozap | Hugo Zapata" /></head>
<body class="w-100 sans-serif bg-white"><header class="bg-black-90  fixed top-0 w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-2"><nav class="f6 fw6 ttu tracked tl tr-ns relative tc">
    <a class="relative block absolute-ns dib-ns left-0 link dim white " href="/">hugozap | Hugo Zapata</a><a class="link dim white dib mr3" href="/about/" title="About">About</a><a class="link dim white dib mr3" href="/projects/" title="Projects and Experiments">Projects and Experiments</a></nav></header>

<main class="ph3 pv5 pa5-ns mt3 mt5-ns" aria-label="Content">
        <article class="measure-wide lh-copy" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 class="f3 f2-m f1-l" itemprop="name headline">Sending and receiving dates from android/java/dotnet the easy way</h1>
    <p class="">
      <time class="" datetime="2012-04-09T00:00:00-05:00" itemprop="datePublished">Apr 9, 2012
      </time></p>
  </header>
  <p class="lh-copy">
    <h2 id="the-problem">The problem</h2>

<p>Date serializing is not as easy as it sounds. If you are using JSON is possible that you will encounter problems with formats, time zone representation, etc.</p>

<p>If you need to send and receive dates from the server to android you have to take this issues into account</p>

<p>Besides that, there is the timezone architecture decision. How will you store your dates?. Will you store everything in UTC? (I prefer this) or will you store the date and have separate columns to store timezone information ( works too but makes date handling more difficult ).</p>

<h2 id="differences-in-parsers-and-formatters">Differences in parsers and formatters</h2>

<p>I’m working on  a mobile application (Android) that sends and receives data from a .NET Backend.
At first i chose ISO Format to send and receive dates. Everything is stored as UTC and only converted to local time to display information to the user.</p>

<p>One problem i faced was that one part was sending the Z character and the other part didn’t understand it. I checked the format strings and everything appeared ok.
After a little googling, i noticed that some APIs used unixtime format and i realized that this is the simplest way to handle it. And i like simplicity.</p>

<h3 id="working-with-unix-time-stamps-in-android-java">Working with unix time stamps in android (java)</h3>
<p>I decided to store the dates as unix time stamps and forget about date handling in sqlite, java, json, .net ( a lot of potential errors ). 
Dates will be sent and received as long values (no json hacks) and i had to have a way to convert those values to the native Date type in the server and client</p>

<p>(note: I use Gson as the Json serializar)</p>

<p>In java i have the following method utilities</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">toUnixTime</span><span class="o">(</span><span class="n">Date</span> <span class="n">d</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="na">getTime</span><span class="o">()/</span><span class="mi">1000L</span><span class="o">;</span>
	<span class="o">}</span>
	
		<span class="kd">public</span> <span class="kd">static</span> <span class="n">Date</span> <span class="nf">FromUnixTime</span><span class="o">(</span><span class="kt">long</span> <span class="n">unix_time</span><span class="o">)</span>
	<span class="o">{</span>	
		<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span> <span class="o">();</span>
		<span class="n">date</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="n">unix_time</span><span class="o">*</span><span class="mi">1000</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">date</span><span class="o">;</span>
	<span class="o">}</span></code></pre></figure>

<p>With Gson one can create custom serializers/deserializers, that’s what we want to send and receive the date as a number:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnixTimeSerializer</span> <span class="kd">implements</span> <span class="n">JsonSerializer</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	  <span class="kd">public</span> <span class="n">JsonElement</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">Date</span> <span class="n">src</span><span class="o">,</span> <span class="n">Type</span> <span class="n">typeOfSrc</span><span class="o">,</span> <span class="n">JsonSerializationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

		<span class="n">JsonNull</span> <span class="n">jnull</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonNull</span><span class="o">();</span>
		<span class="k">if</span><span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
			<span class="k">return</span> <span class="n">jnull</span><span class="o">;</span>
		
	    <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonPrimitive</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">toUnixTime</span><span class="o">(</span><span class="n">src</span><span class="o">));</span>
	  <span class="o">}</span>
	<span class="o">}</span>
	
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnixTimeDeserializer</span> <span class="kd">implements</span> <span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">deserialize</span><span class="o">(</span><span class="n">JsonElement</span> <span class="n">json</span><span class="o">,</span> <span class="n">Type</span> <span class="n">typeOfT</span><span class="o">,</span> <span class="n">JsonDeserializationContext</span> <span class="n">context</span><span class="o">)</span>
	      <span class="kd">throws</span> <span class="n">JsonParseException</span> <span class="o">{</span>

		<span class="k">if</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">isJsonNull</span><span class="o">())</span>
			  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		  <span class="kt">long</span> <span class="n">unixstamp</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsLong</span><span class="o">();</span>		  
		  <span class="k">return</span> <span class="n">ObassiDateUtils</span><span class="o">.</span><span class="na">FromUnixTime</span><span class="o">(</span><span class="n">unixstamp</span><span class="o">);</span>
	  <span class="o">}</span>
	<span class="o">}</span>

	</code></pre></figure>

<p>And to setup the serializers i use the following code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">().</span><span class="na">setDateFormat</span><span class="o">(</span><span class="n">ObassiDateUtils</span><span class="o">.</span><span class="na">isoFormat</span><span class="o">)</span>
				<span class="o">.</span><span class="na">registerTypeAdapter</span><span class="o">(</span><span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">UnixTimeSerializer</span><span class="o">())</span>
				<span class="o">.</span><span class="na">registerTypeAdapter</span><span class="o">(</span><span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">UnixTimeDeserializer</span><span class="o">())</span>
				<span class="o">.</span><span class="na">create</span><span class="o">();</span>
				</code></pre></figure>

<p>The json received from server contains the unix timestamp, however gson deserializes it into the class i select and populates the corresponding date fields.</p>

  </p>
  <a class="" href="/software/2012/04/09/unixtimestamps1.html" hidden></a>

</article>


    </main></body>

</html>
